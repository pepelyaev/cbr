<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Табель учета времени сотрудников</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
    <script type="text/javascript">
        function filterWorker() {
            var workerId = document.getElementById('workerId').value;
            if (workerId) {
                javascript:window.location='/accountingList/' + workerId;
            } else {
                javascript:window.location='/accountingList';
            }
        }
    </script>
</head>
<body>
<div class="my-2 ml-2 mr-2">
    <div class="card">
        <div class="card-body">
            <h2>Табель учета времени сотрудников</h2>
            <div th:switch="${accounting}" class="my-2">
                <p class="my-2">
                    <a href="/accountingEdit" class="btn btn-primary">
                        <i class="fas fa-user-plus ml-2">Добавить запись</i>
                    </a>
                </p>
                <div class="form-group col-md-8">
                    <label for="workerId" class="col-form-label">Фильтр по сотрудникам:</label>
                    <select onchange="filterWorker()" class="form-control" id="workerId">
                        <option value="">Все сотрудники</option>
                        <option th:each="worker : ${workers}"
                                th:value="${worker['id']}"
                                th:utext="${worker['fullName']}"
                                th:selected="${worker['id']==filter}"/>
                    </select>
                </div>
                <div class="col-md-10 p-2">
                    <h4 th:case="null">No record found!</h4>
                    <div th:case="*">
                        <table th:with="total=0" class="table table-striped table-responsive-md">
                            <thead>
                            <tr>
                                <th>Проект</th>
                                <th>Сотрудник</th>
                                <th>Задача</th>
                                <th>Дата</th>
                                <th>Время:<br/>
                                    <span th:text="${#aggregates.sum(accounting.![hms])}"/> (мин)
                                </th>
                                <td colspan="2">&nbsp;</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="account : ${accounting}">
                                <td th:text="${projects[account.projectId-1].name}"></td>
                                <td th:text="${workers[account.workerId-1].fullName}"></td>
                                <td th:text="${account.task}"></td>
                                <td th:text="${#dates.format(account.date,'dd.MM.yyyy')}"></td>
                                <td>
                                    <span th:text="${account.hms}"/> (мин)
                                </td>
                                <td>
                                    <a th:href="@{/accountingEdit/{id}(id=${account.id})}" class="btn btn-primary" title="Редактировать запись">
                                        <i class="fas fa-user-edit ml-2"></i>
                                    </a>
                                </td>
                                <td>
                                    <a th:href="@{/accountingDelete/{id}(id=${account.id})}" class="btn btn-primary" title="Удалить запись">
                                        <i class="fas fa-user-times ml-2"></i>
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
